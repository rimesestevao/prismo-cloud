# Database Documentation

This document provides an overview of the database schemas used in Prismo Cloud.

## MongoDB

MongoDB is used as a staging area for raw, unstructured transaction data.

### `raw_transactions`

- **Description:** Stores the raw transaction data as it is received from the client.
- **Schema:**
  - `transactionIdApp` (String, required, unique): The transaction ID generated by the client application.
  - `rawData` (Object, required): The raw JSON payload from the client.
  - `processed` (Boolean, default: `false`): A flag to indicate whether the transaction has been processed.
  - `createdAt` (Date, default: `Date.now`): The timestamp when the document was created.
  - `processedAt` (Date): The timestamp when the transaction was processed.
  - `apiToken` (String, required): The API token used to submit the transaction.
  - `processingErrors` (Array of Strings): A list of any errors that occurred during processing.

### `processing_logs`

- **Description:** Stores a log of each transaction processing attempt.
- **Schema:**
  - `rawTransactionId` (ObjectId, ref: `RawTransaction`, required): A reference to the corresponding document in the `raw_transactions` collection.
  - `status` (String, enum: `['SUCCESS', 'FAILURE']`, required): The status of the processing attempt.
  - `errorMessage` (String): The error message if the processing failed.
  - `createdAt` (Date, default: `Date.now`): The timestamp when the log was created.

## PostgreSQL

PostgreSQL is used as the primary database for storing structured, processed, and validated transaction data. The schema is managed by Prisma.

### ERD (Entity-Relationship Diagram)

(This is a textual representation of the ERD defined in `prisma/schema.prisma`)

- **User:** Stores user information.
  - `id`, `email`, `api_token`, `created_at`, `updated_at`
- **Transaction:** The central table for storing transaction data.
  - `id`, `user_id`, `transaction_id_app`, `amount`, `transaction_type`, `description`, `transaction_timestamp`, `category`, `created_at`, `updated_at`
- **Counterparty:** Stores information about the other party in the transaction.
- **PaymentMethod:** Stores information about the payment method used.
- **TransactionTag:** Stores tags associated with the transaction.
- **Recurrence:** Stores information about recurring transactions.
- **Attachment:** Stores links to attachments related to the transaction.
- **Location:** Stores location data for the transaction.
- **TransactionMetadata:** Stores metadata about the transaction (e.g., device, app version).

For the detailed schema, please refer to the `prisma/schema.prisma` file.
